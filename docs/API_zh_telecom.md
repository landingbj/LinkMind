# API 接口文档

## 问答接口

POST `/chat/completions`

输入prompt，获取大模型的回答。

### Body 请求参数

```json
    {
      "stream": false,
      "temperature": 0.8,
      "max_tokens": 2048,
      "category": "bj-telecom",
      "identity": "leader",
      "messages": [
        {
          "role": "user",
          "content": "请假"
        }
      ]
    }
```

### 请求参数

| 名称            | 位置   | 类型       | 必选  | 说明                                                                                         |
| ------------- | ---- | -------- | --- | ------------------------------------------------------------------------------------------ |
| body          | body | object   | 否   | none                                                                                       |
| » model       | body | string   | 否   | 模型类型                                                                                       |
| » stream      | body | boolean  | 否   | 是否使用流式接口                                                                                   |
| » temperature | body | number   | 是   | 用来控制语言模型生成文本的创造性和多样性<br/>的参数，范围再0-1之间，调低温度会让模型<br/>生成更加确定和高概率的文本，而调高温<br/>度则会增加文本的随机性和多样性。 |
| » max_tokens  | body | integer  | 是   | 可以生成的最大token数。                                                                             |
| » category    | body | string   | 否   | 数据类别                                                                                       |
| identity      | body | string   | 否   | 身份"leader" or "personnel"                                                                  |
| » messages    | body | [object] | 是   | 提交的消息列表                                                                                    |
| »» role       | body | string   | 否   | user或者assistant, user表示用户提交，<br/>assistant表示大模型输出                                          |
| »» content    | body | string   | 否   | 请求内容                                                                                       |

### 返回示例

> 成功

```json
{
    "id": "chat-b1c1c34bbc9547038e677921b15b850d",
    "object": "chat.completion",
    "created": 1732757419,
    "choices": [
        {
            "index": 0,
            "message": {
                "role": "assistant",
                "content": "根据上述《中国电信北京公司领导人员请假休假管理办法》，领导人员请假休假需遵循以下程序：\n\n1. **提交申请**：首先向公司人力资源部提交请假申请，明确请假事由、行程及日期。\n2. **HR审核**：HR进行初步审核。\n3. **两级审批**：根据职位等级，分别由直接上级审核，间接上级审批。\n   - 对于二级部门主要负责人，需由公司分管副总经理审核，公司总经理审批。\n   - 对于二级部门副职，则由二级部门主要负责人审核，公司分管副总经理审批。\n4. **特别备案**：如公司战略型区分公司纪委书记、信元维护公司纪委书记，还需向公司纪委办公室报备。\n5. **提前通知**：一般应提前2个工作日完成上述流程，紧急情况可先口头或其它方式报批，后续补办手续。\n6. **记录和备案**：审批通过后，还需进行备案，由相关领导或部门记录。\n\n确保请假流程的规范性与及时性，以保证工作的顺利进行。",
                "filename": [
                    "（中电信京〔2024〕74号）《关于印发中国电信北京公司领导人员请假休假管理办法的通知》.pdf"
                ],
                "filepath": [
                    "202410221728242132.pdf"
                ],
                "context": "— 1 —中电信京〔2024〕74 号关于印发中国电信北京公司领导人员请假休假管理办法的通知公司各部门、各区分公司、信元公司、正通公司：现将《中国电信北京公司领导人员请假休假管理办法》予以印发，请认真贯彻执行。中国电信股份有限公司北京分公司2024 年 4 月 7 日— 2 —中国电信北京公司领导人员请假休假管理办法第一章 总则第一条 为加强领导人员日常管理，根据国家法律法规和集团公司《关于印发中国电信集团有限公司领导人员请假休假管理办法的通知》（中国电信〔2024〕5 号）文件要求，结合公司实际情况，制定本办法。第二条 领导人员因私事请假休假离开岗位或工作所在地（北京市，下同），应当按照本办法进行管理。第三条 领导人员请假休假具体类别、天数和情形均须符合国家、北京市政府以及本单位的相关规定。第四条 本办法适用于公司党委管理的三级副及以上领导人员（以下简称“领导人员”）。第二章 审批备案第五条 领导人员拟因私事在工作日离开岗位或工作所在地的，应当按照以下程序进行审批：先经公司人力资源部审核，再实行两级审批制，由直接上级审核，间接上级审批。（一）二级部门主要负责人：由公司分管副总经理审核，公司总经理审批。（二）二级部门副职：由二级部门主要负责人审核，公司分管副总经理审批。— 3 —领导人员拟因私事跨工作日、法定节假日、公休假日离开岗位或工作所在地的，按照上述规定履行相应审批程序。第六条 领导人员拟因私事在法定节假日、公休假日离开工作所在地的，应当按照本办法第五条相应审批权限进行备案。有关领导或相应审核部门对备案事项提出不同意见的，应当向领导人员说明原因，领导人员应当按照相关要求执行。第七条 公司战略型区分公司纪委书记、信元维护公司纪委书记请假休假除履行上述审批或备案程序外，还须按照相关规定向公司纪委办公室报备。第八条 领导人员一般应当提前 2 个工作日履行上述请假休假审批或备案程序。因情况紧急需临机处置的，可按照审批权限先采取口头或其他方式报相应领导同意，再履行相应审批或备案程序。第九条 领导人员应当处理好请假休假与工作的关系，结合公司实际情况合理安排请假休假时间，确保工作正常运转。部门内涉及多名领导人员请假休假的，由所在部门主要负责人统筹协调。第十条 领导人员请假休假应当按照已事先审批或备案的行程和日期执行。领导人员拟出行目的地或请假休假天数因故拟超出已批准或备案范围的，应当事先重新报批或报备；因故未休假或仅部分天数休假的，领导人员应当及时通报人力资源部并销假。— 4 —第十一条 领导人员因公务离开工作单位所在地并在公务结束后，拟在外继续因私事请假休假的，应当事先履行审批或备案程序。第十二条 领导人员报批或报备的请假休假事项应当报告具体事由及完整行程（包括工作日、法定节假日、公休假日，以及全部目的地<省、自治区、直辖市>），并注明紧急联系人及其联系方式等信息。第三章 管理监督第十三条 领导人员应当严格遵守劳动纪律的相关规定。第十四条 各二级部门应当指定专人具体负责，对领导人员请假休假事项审批或备案情况以及实际执行情况进行记录备查。第十五条 领导人员休假前须妥善做好工作安排，休假期间须保持通信畅通。遇重大突发事件等特殊紧急情况应当由本人返岗履职的或上级要求本人返岗处理重要公务的，领导人员应当停止休假并立即返岗，后续可补休，按照相关规定办理。第十六条 领导人员休假期间应当自觉遵守中央八项规定及实施细则精神，严格遵守廉洁自律相关规定，不得违反规定将本人休假相关的费用由本单位、其他单位或他人承担。第十七条 领导人员出现以下情形的，视情节轻重，给予批评教育、责令检查、诫勉、组织处理或党纪政务处分：（一）未按照相关规定向组织事先\n— 1 —中电信京〔2024〕74 号关于印发中国电信北京公司领导人员请假休假管理办法的通知公司各部门、各区分公司、信元公司、正通公司：现将《中国电信北京公司领导人员请假休假管理办法》予以印发，请认真贯彻执行。中国电信股份有限公司北京分公司2024 年 4 月 7 日— 2 —中国电信北京公司领导人员请假休假管理办法第一章 总则第一条 为加强领导人员日常管理，根据国家法律法规和集团公司《关于印发中国电信集团有限公司领导人员请假休假管理办法的通知》（中国电信〔2024〕5 号）文件要求，结合公司实际情况，制定本办法。第二条 领导人员因私事请假休假离开岗位或工作所在地（北京市，下同），应当按照本办法进行管理。第三条 领导人员请假休假具体类别、天数和情形均须符合国家、北京市政府以及本单位的相关规定。第四条 本办法适用于公司党委管理的三级副及以上领导人员（以下简称“领导人员”）。第二章 审批备案第五条 领导人员拟因私事在工作日离开岗位或工作所在地的，应当按照以下程序进行审批：先经公司人力资源部审核，再实行两级审批制，由直接上级审核，间接上级审批。（一）二级部门主要负责人：由公司分管副总经理审核，公司总经理审批。（二）二级部门副职：由二级部门主要负责人审核，公司分管副总经理审批。— 3 —领导人员拟因私事跨工作日、法定节假日、公休假日离开岗位或工作所在地的，按照上述规定履行相应审批程序。第六条 领导人员拟因私事在法定节假日、公休假日离开工作所在地的，应当按照本办法第五条相应审批权限进行备案。有关领导或相应审核部门对备案事项提出不同意见的，应当向领导人员说明原因，领导人员应当按照相关要求执行。第七条 公司战略型区分公司纪委书记、信元维护公司纪委书记请假休假除履行上述审批或备案程序外，还须按照相关规定向公司纪委办公室报备。第八条 领导人员一般应当提前 2 个工作日履行上述请假休假审批或备案程序。因情况紧急需临机处置的，可按照审批权限先采取口头或其他方式报相应领导同意，再履行相应审批或备案程序。第九条 领导人员应当处理好请假休假与工作的关系，结合公司实际情况合理安排请假休假时间，确保工作正常运转。部门内涉及多名领导人员请假休假的，由所在部门主要负责人统筹协调。第十条 领导人员请假休假应当按照已事先审批或备案的行程和日期执行。领导人员拟出行目的地或请假休假天数因故拟超出已批准或备案范围的，应当事先重新报批或报备；因故未休假或仅部分天数休假的，领导人员应当及时通报人力资源部并销假。— 4 —第十一条 领导人员因公务离开工作单位所在地并在公务结束后，拟在外继续因私事请假休假的，应当事先履行审批或备案程序。第十二条 领导人员报批或报备的请假休假事项应当报告具体事由及完整行程（包括工作日、法定节假日、公休假日，以及全部目的地<省、自治区、直辖市>），并注明紧急联系人及其联系方式等信息。第三章 管理监督第十三条 领导人员应当严格遵守劳动纪律的相关规定。第十四条 各二级部门应当指定专人具体负责，对领导人员请假休假事项审批或备案情况以及实际执行情况进行记录备查。第十五条 领导人员休假前须妥善做好工作安排，休假期间须保持通信畅通。遇重大突发事件等特殊紧急情况应当由本人返岗履职的或上级要求本人返岗处理重要公务的，领导人员应当停止休假并立即返岗，后续可补休，按照相关规定办理。第十六条 领导人员休假期间应当自觉遵守中央八项规定及实施细则精神，严格遵守廉洁自律相关规定，不得违反规定将本人休假相关的费用由本单位、其他单位或他人承担。第十七条 领导人员出现以下情形的，视情节轻重，给予批评教育、责令检查、诫勉、组织处理或党纪政务处分：（一）未按照相关规定向组织事先",
                "contextChunkIds": [
                    "f08bf0c40f8f41869cd920bbcf0dd63b",
                    "c53afbbe994c44d4a0b5e4259f4d9cb7"
                ]
            },
            "finish_reason": "stop"
        }
    ],
    "usage": {
        "prompt_tokens": 1965,
        "completion_tokens": 221,
        "total_tokens": 2186
    }
}
```

### 返回结果

| 状态码 | 状态码含义 | 说明  |
| --- | ----- | --- |
| 200 | OK    | 成功  |

### 返回数据结构

状态码 **200**

| 名称                   | 类型       | 必选    | 说明                                               |
| -------------------- | -------- | ----- | ------------------------------------------------ |
| » id                 | string   | true  | 唯一标识符                                            |
| » object             | string   | true  | 对象类型                                             |
| » created            | integer  | true  | 聊天完成创建时的Unix时间戳（秒）                               |
| » choices            | [object] | true  | 选择的列表                                            |
| »» index             | integer  | false | 对象的索引                                            |
| »» message           | object   | false | 返回的消息                                            |
| »»» contextChunkIds  | [object] | false | 上下文对应的索引id列表                                     |
| »»» role             | string   | true  | user或assistant, user表示用户提交，<br/>assistant表示大模型输出 |
| »»» content          | string   | true  | 大模型的输出内容                                         |
| »»» context          | string   | false | 向量数据库查出来的上下文信息                                   |
| »» finish_reason     | string   | false | 模型停止生成的原因                                        |
| » usage              | object   | true  | 完成请求的使用统计                                        |
| »» prompt_tokens     | integer  | true  | 提示中的令牌数量。                                        |
| »» completion_tokens | integer  | true  | 生成的令牌数量                                          |
| »» total_tokens      | integer  | true  | 请求中使用的总令牌数量                                      |

## 订会议室识别

POST `/chat/extractAddMeetingInfo`

根据用户的订会议室请求，提取相关信息并转换为对应的json。用户如果不是一次把所有信息全部输入，需要多次调用该接口。除了第一个请求以外，每次调用该接口都应该把之前已经获取到的会议信息带上。

### Body 请求参数

```json
{
    "message": "会议开始时间17点30",
    "meetingInfo": {
        "meetingAddress": "酒仙桥",
        "date": "2024-09-28",
        "duration": "60",
        "attendance": "5"
    }
}
```

### 请求参数

| 名称                | 位置   | 类型     | 必选  | 说明                            |
| ----------------- | ---- | ------ | --- | ----------------------------- |
| body              | body | object | 否   | none                          |
| » message         | body | string | 是   | 用户输入的消息                       |
| » meetingInfo     | body | object | 否   | 用户已经输入的会议信息，如果是第一个请求，该字段应该为空。 |
| »» meetingAddress | body | string | 否   | 会议地点                          |
| »» date           | body | string | 否   | 会议开始日期                        |
| »» startTime      | body | string | 否   | 会议开始时间                        |
| »» duration       | body | string | 否   | 会议时长                          |
| »» attendance     | body | string | 否   | 会议人数                          |

### 返回示例

> 成功

```json
{
    "meetingInfo": {
        "meetingAddress": "酒仙桥",
        "date": "2024-09-28",
        "startTime": "17:30",
        "duration": "60",
        "attendance": "5"
    },
    "status": "success"
}
```

### 返回结果

| 状态码 | 状态码含义 | 说明  |
| --- | ----- | --- |
| 200 | OK    | 成功  |

### 返回数据结构

状态码 **200**

| 名称                | 类型      | 必选  | 说明           |
| ----------------- | ------- | --- | ------------ |
| » status          | boolean | 是   | 响应状态         |
| » meetingInfo     | object  | 否   | 从用户输入提取的会议信息 |
| »» meetingAddress | string  | 否   | 会议地点         |
| »» date           | string  | 否   | 会议开始日期       |
| »» startTime      | string  | 否   | 会议开始时间       |
| »» duration       | string  | 否   | 会议时长         |
| »» attendance     | string  | 否   | 会议人数         |

## 获取文件列表

GET /uploadFile/getUploadFileList

### 请求参数

| 名称         | 位置    | 类型     | 必选  | 说明    |
| ---------- | ----- | ------ | --- | ----- |
| category   | query | string | 否   | 数据类别  |
| pageSize   | query | string | 否   | 分页的大小 |
| pageNumber | query | string | 否   | 分页的序号 |

> 返回示例

```json
{
  "totalRow": 698,
  "pageNumber": 1,
  "data": [
    {
      "fileId": "2fb4748945684162b071590d2765650b",
      "filename": "14.中电信京人力[2015]2号 关于印发《中国电信股份有限公司北京分公司员工退休管理办法》的通知.pdf",
      "filepath": "202410132337313037.pdf",
      "category": "bj-telecom"
    },
    {
      "fileId": "272582a7e0e04b419448b6e648c44c13",
      "filename": "2.员工因私出国（境）管理办法.doc",
      "filepath": "202410132337336925.doc",
      "category": "bj-telecom"
    }
  ],
  "totalPage": 349,
  "pageSize": 2,
  "status": "success"
}
```

### 返回结果

| 状态码 | 状态码含义                                                   | 说明   | 数据模型   |
| --- | ------------------------------------------------------- | ---- | ------ |
| 200 | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | none | Inline |

### 返回数据结构

状态码 **200**

| 名称           | 类型       | 必选   | 约束   | 中文名 | 说明     |
| ------------ | -------- | ---- | ---- | --- | ------ |
| » totalRow   | integer  | true | none |     | 数据总数   |
| » pageNumber | integer  | true | none |     | 分页的序号  |
| » data       | [object] | true | none |     | none   |
| »» fileId    | string   | true | none |     | 文件ID   |
| »» filename  | string   | true | none |     | 文件名    |
| »» filepath  | string   | true | none |     | 文件相对路径 |
| »» category  | string   | true | none |     | 数据类别   |
| » totalPage  | integer  | true | none |     | 分页总数   |
| » pageSize   | integer  | true | none |     | 分页的大小  |
| » status     | string   | true | none |     | 接口返回状态 |

## 删除上传文件

POST /uploadFile/deleteFile

> Body 请求参数

```json
[
  "b957969f382147b4b05592c1bfc719f2",
  "07c7bbed732f47068ba8170d6858a4da",
  "fd8c04b93f21408fafa57ffb9d26faa4",
  "5f2dc303b5c74af2a5affeb513a93392"
]
```

### 请求参数

| 名称   | 位置   | 类型     | 必选  | 说明   |
| ---- | ---- | ------ | --- | ---- |
| body | body | object | 否   | none |

> 返回示例

```json
{
  "status": "success"
}
```

### 返回结果

| 状态码 | 状态码含义                                                   | 说明   | 数据模型   |
| --- | ------------------------------------------------------- | ---- | ------ |
| 200 | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | none | Inline |

### 返回数据结构

状态码 **200**

| 名称       | 类型     | 必选   | 约束   | 中文名  | 说明   |
| -------- | ------ | ---- | ---- | ---- | ---- |
| » status | string | true | none | 返回状态 | none |

## 上传私训学习文件

POST `/training/upload`

上传私训学习文件，支持txt、word、pdf格式

### Body 请求参数

```yaml
fileToUpload: file://D:/知识图谱.pdf
```

### 请求参数

| 名称             | 位置    | 类型             | 必选  | 说明       |
| -------------- | ----- | -------------- | --- | -------- |
| category       | query | string         | 是   | 指定的数据类别  |
| fileId         | query | string         | 是   | 指定的文件ID  |
| body           | body  | object         | 否   | none     |
| » fileToUpload | body  | string(binary) | 是   | 所上传的私训文件 |

### 返回示例

> 成功

```json
{
  "result": true
}
```

### 返回结果

| 状态码 | 状态码含义 | 说明  |
| --- | ----- | --- |
| 200 | OK    | 成功  |

### 返回数据结构

状态码 **200**

| 名称       | 类型      | 必选   | 说明        |
| -------- | ------- | ---- | --------- |
| » result | boolean | true | 上传私训文件的状态 |

## 根据上下文查询页码

POST `/chat/pdf/cropRect`

输入上下文，定位页码。

### Body 请求参数

```json
{
  "category": "bj-telecom",
  "chunkData": [
    {
      "chunkId": "3d8f74e76c794c8ca60ca64155cab8d9",
      "result": "— 1 —中电信京〔2024〕165 号关于印发中国电信北京公司员工积分管理办法（2024 版）的通知公司各部门、各区分公司、信元公司、正通公司：为进一步完善员工积分体系，打造多样化的积分渠道，强化职业发展价值贡献导向，激发员工的活力和内生动力，促进公司战略落地和优秀人才快速成长，根据集团公司员工职业发展建设的有关要求，公司对《中国电信北京公司员工积分管理办法（试行）》（中电信京〔2017〕190 号）进行了修订。《中国电信北京公司员工积分管理办法（2024 版）》作为员工职业发展管理办法的重要配套文件，现予以印发，请遵照执行。"
    },
     {
      "chunkId": "48aaee358f1f410589cd54358722aec3",
      "result": "— 1 —中电信京〔2024〕165 号关于印发中国电信北京公司员工积分管理办法（2024 版）的通知公司各部门、各区分公司、信元公司、正通公司：为进一步完善员工积分体系，打造多样化的积分渠道，强化职业发展价值贡献导向，激发员工的活力和内生动力，促进公司战略落地和优秀人才快速成长，根据集团公司员工职业发展建设的有关要求，公司对《中国电信北京公司员工积分管理办法（试行）》（中电信京〔2017〕190 号）进行了修订。《中国电信北京公司员工积分管理办法（2024 版）》作为员工职业发展管理办法的重要配套文件，现予以印发，请遵照执行。"
    }
  ]
}
```

### 请求参数

| 名称          | 位置   | 类型       | 必选  | 说明        |
| ----------- | ---- | -------- | --- | --------- |
| body        | body | object   | 否   | none      |
| » category  | body | string   | 否   | 数据类别      |
| » chunkData | body | [object] | 是   | 提交的消息列表   |
| »» chunkId  | body | string   | 否   | 上下文对应索引id |
| »» result   | body | string   | 否   | 上下文内容     |

### 返回示例

> 成功

```json
{
    "message": "success",
    "data": [
        {
            "filename": "（中电信京〔2024〕165号）《关于印发中国电信北京公司员工积分管理办法（2024版）的通知》.pdf",
            "filePath": "202411261109007472.pdf",
            "rects": [
                {
                    "page": 1,
                    "rect": [
                        0,
                        -75,
                        1200,
                        1160
                    ]
                }
            ]
        }
    ]
}
```

### 返回结果

| 状态码 | 状态码含义 | 说明  |
| --- | ----- | --- |
| 200 | OK    | 成功  |

### 返回数据结构

状态码 **200**

| 名称          | 类型       | 必选    | 说明      |
| ----------- | -------- | ----- | ------- |
| » message   | string   | true  | 状态码     |
| » data      | [object] | true  | 对象类型    |
| »» filename | integer  | true  | 文件名称    |
| »» filePath | [object] | true  | 文件相对路径  |
| »»» rects   | [object] | false | 对象的索引列表 |
| »»»» page   | integer  | false | 页码      |
| »»»» rect   | [object] | true  | 定位信息    |

## 根据页码朔源图片

POST `/chat/pdf/cropByRect`

输入上下文，定位页码。

### Body 请求参数

```json
{
    "category": "bj-telecom",
    "chunkData": [
        {
           "filePath": "202411251507080663.pdf",
           "rects": [
                {
                    "page": 3,
                    "rect": [
                        0,
                        -275,
                        1200,
                        1174
                    ]
                },
                {
                    "page": 4,
                    "rect": [
                        0,
                        -275,
                        1200,
                        1172
                    ]
                },
                {
                    "page": 5,
                    "rect": [
                        0,
                        -275,
                        1200,
                        1174
                    ]
                }
            ]
        }
    ]
}
```

### 请求参数

| 名称          | 位置   | 类型       | 必选  | 说明        |
| ----------- | ---- | -------- | --- | --------- |
| body        | body | object   | 否   | none      |
| » category  | body | string   | 否   | 数据类别      |
| » chunkData | body | [object] | 是   | 提交的消息列表   |
| »» filePath | body | string   | 否   | 上下文对应索引id |
| »» rects    | body | [object] | 否   | 上下文内容     |
| »»» page    | body | integer  | 否   | 上下文对应索引id |
| »»» rect    | body | [object] | 否   | 定位信息      |

### 返回示例

> 成功

```json
{
    "message": "success",
    "data": [
        "static/crop/3_0_0_595_842.png",
        "static/crop/4_0_0_595_842.png",
        "static/crop/5_0_0_595_842.png"
    ]
}
```

### 返回结果

| 状态码 | 状态码含义 | 说明  |
| --- | ----- | --- |
| 200 | OK    | 成功  |

### 返回数据结构

状态码 **200**

| 名称        | 类型       | 必选   | 说明     |
| --------- | -------- | ---- | ------ |
| » message | string   | true | 状态码    |
| » data    | [object] | true | 相对路径列表 |

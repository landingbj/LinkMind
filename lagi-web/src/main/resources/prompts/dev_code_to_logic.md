# 代码到业务逻辑描述提示词

## 任务

请分析以下代码并提取详细的业务逻辑描述。

## 你的目标

1. 阅读并理解代码结构
2. 识别主要的业务流程及其目的
3. 用自然语言描述工作流程和数据流
4. **重点识别流程中的决策点、条件判断和分支逻辑**
5. **明确说明不同条件下的流程走向和选择**
6. 解释关键函数、方法及其作用
7. 描述不同组件之间的交互

## 说明

请提供清晰、详细的业务逻辑文字描述。

**重点关注代码从业务角度做什么，而不是如何实现的。**

**特别注意：**
- 明确标注每个流程的条件判断和分支点
- 详细说明每个分支的触发条件
- 描述不同分支的后续流程和最终结果
- 使用"如果...则..."、"当...时..."等结构来描述条件逻辑

## 待分析代码

${{CODE_CONTENT}}

## 输出格式

请按照以下格式提供业务逻辑描述：

### 输出示例

**业务概述**
该系统实现了一个用户订单处理流程，主要负责接收用户订单、验证库存、计算价格并生成订单记录。

**主要业务流程**（重点标注决策点和分支）

1. **订单接收流程**
   - 接收用户提交的订单信息（商品ID、数量、用户ID）
   - 验证订单数据的完整性和有效性
   - 检查用户身份和权限
   - **【决策点1】** 数据验证结果判断：
     - 如果验证失败 → 返回错误信息，流程结束
     - 如果验证成功 → 继续执行库存验证流程

2. **库存验证流程**
   - 查询商品当前库存数量
   - **【决策点2】** 库存充足性判断：
     - **分支A（库存不足）**：
       - 返回"库存不足"错误信息
       - 记录库存不足日志
       - 流程结束，订单创建失败
     - **分支B（库存充足）**：
       - 预锁定对应数量的库存
       - 继续执行价格计算流程

3. **价格计算流程**
   - 获取商品单价
   - 计算订单总价（单价 × 数量）
   - **【决策点3】** 用户优惠判断：
     - 如果用户有可用折扣或优惠券 → 应用折扣，计算优惠后价格
     - 如果没有优惠 → 直接使用原价
   - 计算最终应付金额
   - **【决策点4】** 价格有效性判断：
     - 如果最终金额 ≤ 0 → 返回错误，流程结束
     - 如果最终金额 > 0 → 继续执行订单生成流程

4. **订单生成流程**
   - 创建订单记录并保存到数据库
   - **【决策点5】** 订单保存结果判断：
     - 如果保存失败 → 释放锁定的库存，返回错误
     - 如果保存成功 → 继续后续流程
   - 更新库存数量（正式扣减）
   - 发送订单确认通知给用户
   - 返回订单ID和订单详情，流程完成

**核心组件及作用**

- **OrderController**: 接收HTTP请求，负责订单相关的API入口
- **OrderService**: 订单业务逻辑处理核心，协调各个组件完成订单流程
- **InventoryService**: 库存管理服务，负责查询和更新库存
- **PriceCalculator**: 价格计算工具，处理各种定价规则和折扣
- **OrderRepository**: 数据访问层，负责订单数据的持久化

**数据流向和流程分支**

主流程（成功路径）：
1. 用户请求 → OrderController → OrderService
2. OrderService → 数据验证 → 【决策：验证通过】 → 继续
3. OrderService → InventoryService（查询库存）→ 【决策：库存充足】 → 锁定库存
4. OrderService → PriceCalculator（计算价格）→ 【决策：价格有效】 → 确认价格
5. OrderService → OrderRepository（保存订单）→ 【决策：保存成功】 → 更新库存
6. OrderService → 用户（返回订单结果）

异常分支路径：
- 分支1：数据验证失败 → 返回验证错误 → 流程结束
- 分支2：库存不足 → 返回库存不足错误 → 流程结束
- 分支3：价格计算异常 → 释放库存锁定 → 返回价格错误 → 流程结束
- 分支4：订单保存失败 → 释放库存锁定 → 返回保存错误 → 流程结束

**关键业务规则**

- 订单金额必须大于0
- 库存数量必须充足才能下单
- 每个订单必须关联有效的用户ID
- 订单一旦创建不可修改，只能取消

---

请提供业务逻辑描述：

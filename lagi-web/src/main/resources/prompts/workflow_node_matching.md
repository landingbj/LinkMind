# 工作流节点匹配

## 任务说明
你是一个工作流节点匹配专家。根据结构化的流程描述，你需要为每个步骤匹配合适的节点类型。

**⚠️ 重要原则：只匹配用户明确需要的节点**
- 仅基于【流程描述】中的明确步骤进行匹配
- 不要添加用户未提及的额外功能（如未要求的数据转换、验证、日志等）
- 不要过度解读用户需求，保持流程简洁

## 可用节点类型

${{node-list-template}}

## 输出要求

请为流程描述中的每个步骤匹配合适的节点类型，输出格式如下：

```
## 节点匹配结果

### 步骤0：开始节点（强制）
- **匹配节点类型**：start
- **匹配原因**：工作流的起始节点，必须包含
- **节点配置要点**：根据【提取的变量】中的 startNodeVariables 配置输出
- **输入端口**：无
- **输出端口**：[列出所有输出变量]

### 步骤1：[步骤名称]
- **匹配节点类型**：[节点类型]
- **匹配原因**：[为什么选择这个节点类型]
- **节点配置要点**：[该节点需要配置哪些关键参数]
- **输入端口**：[需要接收哪些输入]
- **输出端口**：[会产生哪些输出]

### 步骤2：[步骤名称]
...

### 步骤N：结束节点（强制）
- **匹配节点类型**：end
- **匹配原因**：工作流的结束节点，必须包含
- **节点配置要点**：根据【提取的变量】中的 endNodeVariables 配置输入
- **输入端口**：[列出所有输入变量及来源]
- **输出端口**：无

## 节点连接关系
按照流程顺序，说明节点之间的连接关系：
1. start → [第一个中间节点]：[连接说明，传递什么数据]
2. [节点A] → [节点B]：[连接说明]
...
N. [最后一个中间节点] → end：[连接说明，传递最终结果]

## 特殊逻辑处理
如果有条件判断或循环：
- **条件判断**：[使用condition节点，说明判断条件和分支]
- **循环处理**：[使用loop节点，说明循环数据和循环体]

**⚠️ 重要提醒**：
- 必须在步骤0列出 start 节点
- 必须在最后一步列出 end 节点
- 所有工作流都必须有这两个节点
```

## 匹配规则
1. **开始步骤** → 必须使用 **start** 节点
2. **结束步骤** → 必须使用 **end** 节点
3. **知识库/文档检索** → 使用 **knowledgeBase** 节点
4. **文本生成/问答/总结** → 使用 **llm** 节点
5. **意图识别/分类判断** → 使用 **intent** 节点
6. **条件分支** → 使用 **condition** 节点
7. **列表遍历/批量处理** → 使用 **loop** 节点

## 重要：相同类型节点的拆分规则

**⚠️ 关键原则**：当流程中需要多次使用同一类型节点，但用途、配置、输入不同时，必须识别为多个独立节点！

### 拆分识别标准
1. **多步骤描述**：步骤中出现"先...然后..."、"第一步...第二步..."、"再..."、"接着..."
2. **不同输入来源**：节点的输入数据来自不同的上游节点
3. **不同配置要求**：节点的配置参数（如prompt、query、url）明显不同
4. **不同输出用途**：节点的输出被不同的下游节点使用

### 典型场景示例

#### 场景1：多个LLM节点
**描述**："先用LLM总结文档，然后用LLM根据总结生成一篇文章"
**分析**：
- 第一个LLM：输入文档内容，输出总结
- 第二个LLM：输入总结，输出文章
**匹配结果**：需要2个LLM节点（llm_1 和 llm_2）

#### 场景2：多个知识库节点
**描述**："分别从技术文档库和FAQ库检索信息"
**分析**：
- 第一个知识库：检索技术文档库
- 第二个知识库：检索FAQ库
**匹配结果**：需要2个knowledge-base节点

#### 场景3：多个API节点
**描述**："先调用天气API获取天气，再调用新闻API获取新闻"
**分析**：
- 第一个API：调用天气API
- 第二个API：调用新闻API
**匹配结果**：需要2个api节点

### 错误示例
❌ **错误**：将"先总结后生成文章"识别为1个LLM节点
✅ **正确**：识别为2个LLM节点（总结节点 + 生成节点）

## 示例

### 输入（结构化流程描述）
```
## 流程目标
实现智能问答系统，根据用户问题类型选择不同的处理路径

## 流程步骤
步骤1：接收用户输入
步骤2：意图识别 - 判断是技术问题还是闲聊
步骤3a：知识库检索（技术问题分支）
步骤4a：LLM生成回答（技术问题分支）
步骤3b：LLM直接回复（闲聊分支）
步骤5：输出结果
```

### 输出（节点匹配结果）
```
## 节点匹配结果

### 步骤1：接收用户输入
- **匹配节点类型**：start
- **匹配原因**：这是工作流的起始节点，用于接收用户的初始输入
- **节点配置要点**：输出用户的query文本
- **输入端口**：无（起始节点）
- **输出端口**：query（用户输入的问题文本）

### 步骤2：意图识别
- **匹配节点类型**：intent
- **匹配原因**：需要识别用户意图，判断问题类型
- **节点配置要点**：配置意图分类模型，输出意图类别
- **输入端口**：query（来自start节点）
- **输出端口**：intent（意图类别："技术问题" 或 "闲聊"）

### 步骤2.5：条件判断
- **匹配节点类型**：condition
- **匹配原因**：根据意图识别结果，选择不同的处理分支
- **节点配置要点**：判断intent的值，定义两个分支
- **输入端口**：intent（来自intent节点）
- **输出端口**：技术问题分支、闲聊分支

### 步骤3a：知识库检索
- **匹配节点类型**：knowledgeBase
- **匹配原因**：需要从知识库检索相关技术文档
- **节点配置要点**：配置知识库ID，设置检索参数
- **输入端口**：query（来自start节点，通过condition分支传递）
- **输出端口**：context（检索到的文档内容）

### 步骤4a：LLM生成回答（技术问题）
- **匹配节点类型**：llm
- **匹配原因**：需要基于知识库内容生成专业回答
- **节点配置要点**：配置提示词，将context作为背景信息传入
- **输入端口**：query（用户问题）、context（知识库内容）
- **输出端口**：answer（生成的回答）

### 步骤3b：LLM直接回复（闲聊）
- **匹配节点类型**：llm
- **匹配原因**：直接使用LLM生成闲聊回复
- **节点配置要点**：配置闲聊提示词
- **输入端口**：query（用户问题）
- **输出端口**：answer（生成的回答）

### 步骤5：输出结果
- **匹配节点类型**：end
- **匹配原因**：这是工作流的结束节点，输出最终结果
- **节点配置要点**：提取answer字段作为最终输出
- **输入端口**：answer（来自步骤4a或3b的LLM输出）
- **输出端口**：无（结束节点）

## 节点连接关系
1. start → intent：传递用户query
2. intent → condition：传递识别出的意图
3. condition → knowledgeBase（技术问题分支）：传递用户query
4. condition → llm-闲聊（闲聊分支）：传递用户query
5. knowledgeBase → llm-技术：传递用户query和检索到的context
6. llm-技术 → end：传递生成的answer
7. llm-闲聊 → end：传递生成的answer

## 特殊逻辑处理
- **条件判断**：使用condition节点，根据intent的值进行分支：
  - intent == "技术问题" → 执行 knowledgeBase → llm-技术 路径
  - intent == "闲聊" → 执行 llm-闲聊 路径
  - 两个分支最终汇聚到end节点
```

## 注意事项
1. **✅ 强制要求：必须包含 start 和 end 节点**
   - 在"步骤0"处必须列出 start 节点
   - 在最后一步必须列出 end 节点
   - 这两个节点是工作流的最低要求，不可遗漏
2. **使用提取的变量**：如果系统已经提取了开始节点和结束节点的变量信息，start节点和end节点的配置要使用这些变量
3. 节点类型要与步骤的功能准确匹配
4. 要清晰说明节点之间的数据传递关系
5. 对于条件分支，要明确使用condition节点
6. 对于循环处理，要明确使用loop节点
7. 保持输出结构清晰，便于后续生成JSON配置
8. **start节点的输出变量**和**end节点的输入变量**要与已提取的变量定义保持一致
9. **仔细识别相同类型节点的拆分需求**：不要将多个步骤合并为一个节点
10. **节点输出字段使用标准名称**：llm/knowledge-base/program等节点的输出字段统一为`result`，intent节点输出为`intent`，api节点输出为`statusCode`和`body`
11. **⚠️ 节点输入字段必须严格遵守定义**：每种节点的输入字段是固定的，不要根据常识添加额外字段
    - 例如：TTS节点只有 `text`、`model`、`voice`、`volume`、`format` 五个输入字段
    - 禁止添加：`voiceModel`、`languageCode`、`speed`、`pitch` 等节点定义中不存在的字段

